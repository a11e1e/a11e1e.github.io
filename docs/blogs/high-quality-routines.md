---
date: 2021-11-26
title: 撰写高质量的例程
description: 本文是《代码大全》第六章的部分翻译。
---

# 撰写高质量的例程

什么是例程？例程是为了某一单一目的所调用的方法。在大部分语言，包括 JavaScript / C++ 中就是一个函数。所以本文几乎可以等同于「如何撰写高质量的函数」？下文我会用「函数」代替「例程」，因为函数听上去更加亲近。

## 给我一个理由去撰写高质量的函数

我认为两点就够了：

- 减少复杂性
- 代码复用

书中还介绍了诸如：

- 隐藏指针操作
- 简化测试
- 提升性能
- ...

这些都是理由，但我认为前两点就已经足够。

## 好的函数名

好的函数名应当清晰地描述函数所做的一切。该怎么做？

### 描述例程所做的一切

如果有那么一个函数，计算一些数据，并且打开一个输出用的文件。那么`ComputeReportTotals`就不够准确。而`ComputeReportTotalsAndOpenOutputFile`就太长太蠢了。如果你的函数里有副作用（在这个例子中就是打开一个输出文件），那么你就很容易得到一个很长很蠢的名字。所以你的函数尽可能不要有副作用，同时少用描述性的词语。

### 避免使用模糊的动词

反面教材：

- `HandleCalculation`
- `PerformServices`
- `OutputUser`
- `ProcessInput`

但“handle”有时候是个例外。对于事件处理函数来说，偶尔使用也无可厚非。

有时候，你的函数写的很好，但只是名字不好。而有时候你的函数本身就做了一件很模糊的事情，这就说明你可能需要重构一下这个函数，使之具有更强的目的性。

### 不要加上数字来区分函数

- `OutputUser`
- `OutputUser1`
- `OutputUser2`

看着不觉得恶心么？

### 函数名可以长一些

研究表示最好的函数名应该在**9-15**个字符之间。函数名和变量名不一样，可以长一点。

### 用返回值来命名函数（function）

如果一个函数有返回值，那么应该用返回值来命名函数。

- `customerId.Next()`
- `pen.CurrentColor()`
- `printer.IsReady()`

就是一些好例子

### 用动词+名词来命名过程（procedure）

如果一个函数没有返回值，那么应该用动词+名词来命名。

- `PrintDocument`
- `checkOrderInfo`

就不错。

如果这个函数是一个类方法，有时候就不需要名词，直接动词就好了。

- `document.Print`
- `orderInfo.Check`

### 正确使用反义词

书中举了很多例子

- add / remove
- lock / unlock
- show / hide
- source / target

不一而足。

### 约定一致的准则

比如同样获取用户 id

- `employee.id.Get()`
- `dependent.GetId()`
- `candidate.id()`

这就看起来很杂乱。应当规定好只使用一种方式获取 id。

## 一个函数应该多长？

这个问题没有很明确的回答。

有种说法是，一个函数应该能用一个屏幕 🖥 看完。或者，用两张纸就能打印完。根据这些说法，大概 50 - 150 行是个合理范围。

书中还介绍了很多研究。最终给出了一个结论————不**算注释的话，超过两百行的函数可能就需要小心了**。我也赞同这个结论。

## 函数的参数

### 参数顺序

参数顺序应当是

- 输入的参数
- 被更改的参数
- 输出的参数。

::: tip
将参数作为返回值一般来说是 C/C++ 会做的事情，JavaScript 很少会这么做。
:::

### 如果多个函数使用类似的参数，那么这几个参数的顺序应当相同。

### 所有的参数都要被用到

### 尽可能不要去更改参数

### 参数不要超过七个

七个数字是大部分人记忆的极限。你可以记住一个六位数，但你很难瞬间记住一个 11 位的电话号码。
